<script>
let options = {};
let articles = [];
let currentIndex = null;

(async function init() {
  [options, articles] = await Promise.all([
    fetch('options.json').then(r=>r.json()),
    fetch('articles.json').then(r=>r.json())
  ]);

  fillSelect('rueId', options.rues.map(r=>r.nom), true);
  fillSelect('periode', options.periodes);
  fillSelect('famille', options.familles, true);
  fillSelect('theme', options.themes);

  const sel = articleSelect;
  articles.forEach((a,i)=>{
    const o = document.createElement('option');
    o.value = i;
    o.textContent = a.title;
    sel.appendChild(o);
  });
  sel.onchange = () => loadArticle(sel.value);

  renderLieux();
})();

function addLieu() {
  const name = prompt("Nom du lieu");
  if(!name) return;
  const id = prompt("ID unique (ex: rue-reux)");
  if(!id) return;
  const lat = parseFloat(prompt("Latitude"));
  const lng = parseFloat(prompt("Longitude"));
  if(isNaN(lat)||isNaN(lng)) return alert("CoordonnÃ©es invalides");

  const newLieu = { id, nom: name, coords: [lat,lng] };
  options.rues.push(newLieu);
  lieuxOut.value = JSON.stringify(options.rues,null,2);
  fillSelect('rueId', options.rues.map(r=>r.nom), true);
}

function renderLieux() {
  const container = document.getElementById('lieux');
  container.innerHTML = '';
  options.rues.forEach(l => {
    const div = document.createElement('div');
    div.textContent = `${l.nom} (ID: ${l.id}) ğŸ“ [${l.coords.join(', ')}]`;
    container.appendChild(div);
  });
}
</script>
